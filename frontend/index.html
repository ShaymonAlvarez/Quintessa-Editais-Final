<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Editais Watcher</title>
    <link rel="stylesheet" href="/static/styles.css?v=qs-roxo-2">
    <!-- Garantia de comportamento de abas: s√≥ mostra a ativa -->
    <style>
      .tab-panel{display:none;}
      .tab-panel.active{display:block;}
    </style>
  </head>
  <body class="collect-theme">
    <header class="app-header">
      <h1>üóûÔ∏è Automa√ß√£o de Editais - Quintessa</h1>
    </header>

    <main class="app-main">
      <nav class="tabs-nav">
        <button class="tab-btn active" data-tab="manage">üß∞ Coleta e gest√£o</button>
        <button class="tab-btn" data-tab="perplexity">üîé Pesquisa (Perplexity)</button>
      </nav>

      <!-- ABA: COLETA E GEST√ÉO -->
      <section id="tab-manage" class="tab-panel active">
        <div class="collect-layout">
          <!-- Sidebar -->
          <aside class="collect-sidebar">
            <div class="qs-logo">
              <img src="/static/logo2.png" alt="QUINTESSA" />
            </div>

            <nav class="side-actions">
              <button class="side-cta" onclick="window.location.href='/'">P√ÅGINA INICIAL</button>
              <button class="side-cta" data-perplexity-nav onclick="location.hash='#perplexity'">PESQUISA NO PERPLEXITY</button>
              <a class="side-cta" href="https://docs.google.com/spreadsheets/" target="_blank" rel="noopener">IR PARA PLANILHA ATUAL</a>
            </nav>
          </aside>

          <!-- Conte√∫do -->
          <div class="collect-content">
            <header class="collect-hero">
              <h2>BUSCA E COLETA</h2>
            </header>

            <!-- Toolbar em 3 colunas -->
            <section class="collect-toolbar">
              <!-- ESQ: FILTRAR POR -->
              <div class="filter-column">
                <div class="filter-line">
                  <div class="filter-title">FILTRAR POR:</div>
                  <div class="filter-chips filter-chips-inline">
                    <button class="chip" id="chip-data">
                      Data: dd/mm/aaaa <span class="caret">‚ñæ</span>
                    </button>

                    <button class="chip" id="chip-valor">
                      Valor: de 0 at√© 5mil reais <span class="caret">‚ñæ</span>
                    </button>

                    <button class="chip chip-deadline" data-deadline="7">7 dias</button>
                    <button class="chip chip-deadline" data-deadline="10">10 dias</button>
                    <button class="chip chip-deadline" data-deadline="15">15 ou + dias</button>
                  </div>
                </div>
              </div>

              <!-- MEIO: grupos -->
              <div class="groups-column">
                <div class="groups-to-collect">
                  <div class="groups-title">GRUPOS A COLETAR</div>
                  <div id="groups-checkboxes" class="groups-list"></div>
                </div>
              </div>

              <!-- DIR: a√ß√µes empilhadas -->
              <div class="actions-column">
                <button id="btn-diag" class="pill-btn">DIAGN√ìSTICO</button>
                <button id="btn-clear-all" class="pill-btn pill-alt">RESETAR PLANILHA</button>
                <button id="btn-run-collect" class="pill-btn pill-primary">RODAR COLETA</button>
              </div>
            </section>

            <!-- input de data invis√≠vel para seletor nativo -->
            <input type="date" id="filter-date" class="visually-hidden-date" />

            <!-- Overlays (iniciam escondidos) -->
            <div id="collect-progress" class="progress-overlay hidden">
              <div class="progress-box">
                <span id="collect-progress-label" class="progress-label">Preparando coleta‚Ä¶</span>
                <progress id="collect-progress-bar" value="0" max="1"></progress>
                <button id="btn-cancel-collect" class="danger" data-keep-enabled="true">Cancelar coleta</button>
              </div>
            </div>

            <div id="collect-result"></div>

            <!-- Diagn√≥stico (escondido at√© clicar) -->
            <section id="diag-section" class="hidden">
              <h2>üî¨ Diagn√≥stico dos providers</h2>
              <div class="diag-filters">
                <div>
                  <label>Regex Governo/Multilaterais</label>
                  <input id="diag-re-gov" type="text" />
                </div>
                <div>
                  <label>Regex Filantropia</label>
                  <input id="diag-re-phil" type="text" />
                </div>
                <div>
                  <label>Regex Am√©rica Latina / Brasil</label>
                  <input id="diag-re-latam" type="text" />
                </div>
                <button id="btn-run-diag">Rodar diag</button>
              </div>

              <div id="diag-progress" class="progress-overlay hidden">
                <div class="progress-box">
                  <span id="diag-progress-label" class="progress-label">Preparando diagn√≥stico‚Ä¶</span>
                  <progress id="diag-progress-bar"></progress>
                  <button id="btn-cancel-diag" class="danger" data-keep-enabled="true">Cancelar diagn√≥stico</button>
                </div>
              </div>

              <div id="diag-results"></div>
            </section>

            <!-- Grupos -->
            <section id="groups-container"></section>

            <section id="errors-section" class="hidden">
              <h2>‚ö†Ô∏è Erros desta execu√ß√£o</h2>
              <div id="errors-list"></div>
            </section>
          </div>
        </div>

        <!-- Mini modal de VALOR -->
        <div id="value-modal" class="modal hidden">
          <div class="modal-card">
            <h3>Filtrar por valor (R$)</h3>
            <label class="modal-row">
              M√°ximo:
              <input type="number" id="value-max" min="0" step="100" placeholder="5000" />
            </label>
            <div class="modal-actions">
              <button id="value-cancel">Cancelar</button>
              <button id="value-apply" class="primary">Aplicar</button>
            </div>
          </div>
        </div>
      </section>

      <!-- ABA: PERPLEXITY (se√ß√£o irm√£ da de coleta) -->
      <section id="tab-perplexity" class="tab-panel">
        <div class="collect-layout">
          <!-- Sidebar id√™ntica -->
          <aside class="collect-sidebar">
            <div class="qs-logo">
              <img src="/static/logo2.png" alt="QUINTESSA" />
            </div>

            <nav class="side-actions">
              <button class="side-cta" onclick="location.hash='#manage'">VOLTAR √Ä COLETA</button>
              <!-- mesmo seletor nas duas abas -->
              <button class="side-cta" data-perplexity-nav onclick="location.hash='#perplexity'">PESQUISA NO PERPLEXITY</button>
              <a class="side-cta" href="https://docs.google.com/spreadsheets/" target="_blank" rel="noopener">IR PARA PLANILHA ATUAL</a>
            </nav>
          </aside>

          <!-- Conte√∫do Perplexity com o mesmo padding/tema -->
          <div class="collect-content">
        <h2>üîé Busca inteligente com Perplexity</h2>
        <p class="caption">
          Fa√ßa perguntas sobre editais e receba um resumo com fontes. Resultados tamb√©m s√£o gravados em uma aba da planilha.
        </p>

        <!-- Tabela de pre√ßos por modelo -->
        <section class="pplx-cost-panel">
          <h3>üí∞ Estimativa de custo</h3>
          <span class="usd-badge">
            COTA√á√ÉO DO D√ìLAR HOJE: R$ <b id="dolar-value">5.20</b>
          </span>
          <p class="caption">
            Ajuste abaixo os valores de refer√™ncia de cada modelo (US$ por 1M tokens de entrada e sa√≠da).
            A estimativa usa o modelo selecionado no painel √† direita.
          </p>
          <table class="pplx-cost-table">
            <thead>
              <tr>
                <th>Modelo</th>
                <th>Input (US$/1M)</th>
                <th>Output (US$/1M)</th>
              </tr>
            </thead>
            <tbody>
              <tr data-model="sonar">
                <td>Sonar</td>
                <td><input type="number" id="cost-in-sonar" min="0" step="0.1" value="1" /></td>
                <td><input type="number" id="cost-out-sonar" min="0" step="0.1" value="1" /></td>
              </tr>
              <tr data-model="sonar-pro">
                <td>Sonar Pro</td>
                <td><input type="number" id="cost-in-sonar-pro" min="0" step="0.1" value="3" /></td>
                <td><input type="number" id="cost-out-sonar-pro" min="0" step="0.1" value="15" /></td>
              </tr>
              <tr data-model="sonar-reasoning">
                <td>Sonar Reasoning</td>
                <td><input type="number" id="cost-in-sonar-reasoning" min="0" step="0.1" value="1" /></td>
                <td><input type="number" id="cost-out-sonar-reasoning" min="0" step="0.1" value="5" /></td>
              </tr>
              <tr data-model="sonar-reasoning-pro">
                <td>Sonar Reasoning Pro</td>
                <td><input type="number" id="cost-in-sonar-reasoning-pro" min="0" step="0.1" value="2" /></td>
                <td><input type="number" id="cost-out-sonar-reasoning-pro" min="0" step="0.1" value="8" /></td>
              </tr>
              <tr data-model="sonar-deep-research">
                <td>Sonar Deep Research</td>
                <td><input type="number" id="cost-in-sonar-deep-research" min="0" step="0.1" value="2" /></td>
                <td><input type="number" id="cost-out-sonar-deep-research" min="0" step="0.1" value="8" /></td>
              </tr>
            </tbody>
          </table>
          <div class="pplx-cost-footer">
            <div>
              <label>Cota√ß√£o USD ‚Üí BRL</label>
              <input type="number" id="usd-brl" step="0.1" min="1" value="5.2" />
            </div>
          </div>
        </section>

        <section class="pplx-main">
          <!-- ESQUERDA: Modelos + Link do edital + Prompt final -->
          <div class="pplx-left">
            <h3>Prompt (Modelos)</h3>

            <label>Modelo de prompt</label>
            <select id="pplx-tpl">
              <option value="listar">Listar oportunidades</option>
              <option value="resumo">Resumo de edital</option>
              <option value="comparar">Comparar chamadas</option>
            </select>

            <div class="pplx-tpl-grid">
              <div>
                <label>Tema</label>
                <input type="text" id="pplx-tema" value="bioeconomia" />
              </div>
              <div>
                <label>Regi√£o</label>
                <input type="text" id="pplx-reg" value="Amaz√¥nia/LatAm" />
              </div>
              <div>
                <label>Prazo m√≠nimo (dias)</label>
                <input type="number" id="pplx-dias" value="21" min="0" max="365" />
              </div>
            </div>

            <div class="pplx-link-row">
              <div class="pplx-link-main">
                <label>Link do edital (PDF/DOC ou p√°gina)</label>
                <input type="text" id="pplx-edital-link" placeholder="https://..." />
              </div>
              <div class="pplx-link-actions">
                <button id="pplx-count-tokens" type="button">üìä Estimar tokens do link</button>
                <span id="pplx-link-tokens" class="caption">‚Äî</span>
              </div>
            </div>

            <label>Prompt final enviado para a Perplexity</label>
            <textarea id="pplx-tpl-output" rows="8" readonly></textarea>
            <p class="caption">
              O prompt acima √© o texto que ser√° enviado para a API, combinando o modelo escolhido, tema, regi√£o, prazo e link do edital.
            </p>
          </div>

          <!-- DIREITA: modelo, temperatura, max_tokens, salvar, m√©tricas -->
          <div class="pplx-right">
            <label for="pplx-model">Modelo</label>
            <select id="pplx-model">
              <option value="sonar">Sonar ‚Äì r√°pido e barato (geral)</option>
              <option value="sonar-pro">Sonar Pro ‚Äì an√°lise mais profunda</option>
              <option value="sonar-reasoning">Sonar Reasoning ‚Äì racioc√≠nio passo a passo</option>
              <option value="sonar-reasoning-pro">Sonar Reasoning Pro ‚Äì racioc√≠nio avan√ßado</option>
              <option value="sonar-deep-research">Sonar Deep Research ‚Äì pesquisa longa e detalhada</option>
            </select>

            <label for="pplx-temp">Temperatura</label>
            <div class="pplx-temp-row">
              <input type="range" id="pplx-temp" min="0" max="1" step="0.05" value="0.2" />
              <span id="pplx-temp-value">0.2</span>
            </div>
            <p id="pplx-temp-help" class="caption">
              Valores baixos (0‚Äì0,3) deixam a resposta mais previs√≠vel e focada no edital. Valores altos (0,7‚Äì1,0) deixam a resposta mais criativa e variada, podendo ‚Äúviajar‚Äù mais.
            </p>

            <label for="pplx-max">Sa√≠da esperada (tokens)</label>
            <input type="number" id="pplx-max" min="256" max="4096" step="64" value="900" />
            <p class="caption">
              Esse valor √© usado tanto para limitar o tamanho m√°ximo da resposta da API quanto para estimar o custo aproximado.
            </p>

            <label>
              <input type="checkbox" id="pplx-save" checked />
              Gravar na planilha (aba "perplexity")
            </label>

            <div class="pplx-metrics">
              <div>
                <strong>Tokens de entrada (aprox.)</strong>
                <div id="metric-tokens-in">0</div>
              </div>
              <div>
                <strong>Custo estimado (US$)</strong>
                <div id="metric-cost-usd">0.0000</div>
              </div>
              <div>
                <strong>Custo estimado (R$)</strong>
                <div id="metric-cost-brl">0.0000</div>
              </div>
            </div>

            <button id="btn-pplx-run" class="primary">üîé Rodar pesquisa agora</button>
          </div>
        </section>

        <section id="pplx-output">
          <h3>Resumo</h3>
          <div id="pplx-summary"></div>

          <h3>Fontes citadas</h3>
          <ul id="pplx-links"></ul>
        </section>

        <section id="pplx-errors" class="hidden">
          <h3>‚ö†Ô∏è Erros</h3>
          <div id="pplx-errors-list"></div>
        </section>
          </div> <!-- /collect-content -->
        </div>   <!-- /collect-layout -->
      </section>
    </main>

    <script src="/static/app.js?v=qs-roxo-2"></script>
  </body>
</html>